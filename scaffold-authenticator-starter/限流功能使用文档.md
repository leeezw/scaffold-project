# é™æµåŠŸèƒ½ä½¿ç”¨æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

é™æµåŠŸèƒ½ç”¨äº**é˜²æ­¢APIè¢«æ¶æ„è¯·æ±‚ã€ä¿æŠ¤ç³»ç»Ÿèµ„æºã€é˜²æ­¢Tokenè¢«æš´åŠ›ä½¿ç”¨**ã€‚åŸºäº Redis å®ç°åˆ†å¸ƒå¼é™æµï¼Œæ”¯æŒå¤šç§é™æµç»´åº¦å’Œç®—æ³•ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **å¤šç»´åº¦é™æµ**ï¼šæ”¯æŒ IPã€ç”¨æˆ·ã€Tokenã€å…¨å±€å››ç§é™æµç»´åº¦
- âœ… **åŒç®—æ³•æ”¯æŒ**ï¼šæ»‘åŠ¨çª—å£ï¼ˆæ¨èï¼‰å’Œå›ºå®šçª—å£ç®—æ³•
- âœ… **æ³¨è§£é©±åŠ¨**ï¼šä½¿ç”¨ `@RateLimit` æ³¨è§£ï¼Œç®€å•æ˜“ç”¨
- âœ… **åˆ†å¸ƒå¼æ”¯æŒ**ï¼šåŸºäº Redisï¼Œæ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²
- âœ… **çµæ´»é…ç½®**ï¼šæ”¯æŒæ–¹æ³•çº§åˆ«å’Œç±»çº§åˆ«é…ç½®
- âœ… **è‡ªåŠ¨é›†æˆ**ï¼šSpring Boot Starterï¼Œå¼€ç®±å³ç”¨

## ğŸ”§ å·¥ä½œåŸç†

### é™æµæµç¨‹

```
è¯·æ±‚åˆ°è¾¾ â†’ RateLimitAspect æ‹¦æˆª â†’ æå–é™æµKey â†’ 
è°ƒç”¨ RateLimitService â†’ Redis æ£€æŸ¥ â†’ 
å…è®¸ â†’ ç»§ç»­æ‰§è¡Œ
æ‹’ç» â†’ æŠ›å‡ºå¼‚å¸¸ï¼ˆ429 Too Many Requestsï¼‰
```

### é™æµKeyç”Ÿæˆè§„åˆ™

| ç±»å‹ | Keyæ ¼å¼ | ç¤ºä¾‹ |
|------|---------|------|
| IP | `{ip}:{method}:{path}` | `192.168.1.1:POST:/api/auth/login` |
| USER | `user:{userId}:{method}:{path}` | `user:123:GET:/api/users/list` |
| TOKEN | `token:{tokenHash}:{method}:{path}` | `token:abc123...:POST:/api/users/create` |
| GLOBAL | `global:{method}:{path}` | `global:POST:/api/auth/login` |

### æ»‘åŠ¨çª—å£ç®—æ³•ï¼ˆæ¨èï¼‰

ä½¿ç”¨ Redis Sorted Set å®ç°ï¼š

```
Key: rate_limit:sliding:{key}
Value: Sorted Set
  - Score: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
  - Member: è¯·æ±‚IDï¼ˆUUIDï¼‰

æµç¨‹ï¼š
1. åˆ é™¤çª—å£å¤–çš„è®°å½•ï¼ˆscore < currentTime - window * 1000ï¼‰
2. ç»Ÿè®¡çª—å£å†…çš„è®°å½•æ•°
3. å¦‚æœ < maxRequestsï¼Œæ·»åŠ æ–°è®°å½•å¹¶è¿”å› true
4. å¦åˆ™è¿”å› false
```

**ä¼˜ç‚¹**ï¼š
- æ›´å¹³æ»‘ï¼Œé¿å…çªå‘æµé‡
- é™æµæ›´ç²¾ç¡®
- é€‚åˆå¤§å¤šæ•°åœºæ™¯

### å›ºå®šçª—å£ç®—æ³•

ä½¿ç”¨ Redis String + TTL å®ç°ï¼š

```
Key: rate_limit:fixed:{key}:{windowStart}
Value: è¯·æ±‚è®¡æ•°

æµç¨‹ï¼š
1. è®¡ç®—å½“å‰çª—å£å¼€å§‹æ—¶é—´
2. è·å–æˆ–åˆ›å»ºè®¡æ•°å™¨
3. é€’å¢è®¡æ•°
4. è®¾ç½®TTL = window
5. å¦‚æœè®¡æ•° > maxRequestsï¼Œè¿”å› false
6. å¦åˆ™è¿”å› true
```

**ä¼˜ç‚¹**ï¼š
- å®ç°ç®€å•
- Redisæ“ä½œå°‘ï¼Œæ€§èƒ½å¥½
- é€‚åˆé«˜å¹¶å‘åœºæ™¯

**ç¼ºç‚¹**ï¼š
- çª—å£è¾¹ç•Œå¯èƒ½æœ‰çªå‘æµé‡

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨ï¼ˆæ–¹æ³•çº§åˆ«ï¼‰

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // IPé™æµï¼š60ç§’å†…æœ€å¤š10æ¬¡è¯·æ±‚
    @RateLimit(type = RateLimitType.IP, window = 60, maxRequests = 10)
    @PostMapping("/create")
    public Result<Void> createUser(@RequestBody UserDTO user) {
        // ...
    }
    
    // ç”¨æˆ·é™æµï¼š60ç§’å†…æœ€å¤š50æ¬¡è¯·æ±‚
    @RateLimit(type = RateLimitType.USER, window = 60, maxRequests = 50)
    @GetMapping("/list")
    public Result<List<UserDTO>> listUsers() {
        // ...
    }
}
```

### 2. ç±»çº§åˆ«é™æµ

```java
// ç±»çº§åˆ«é™æµï¼šæ•´ä¸ªControllerä½¿ç”¨ç›¸åŒçš„é™æµé…ç½®
@RateLimit(type = RateLimitType.IP, window = 60, maxRequests = 100)
@RestController
@RequestMapping("/api/auth")
public class AuthController {
    
    // ç»§æ‰¿ç±»çº§åˆ«çš„é™æµé…ç½®
    @PostMapping("/login")
    public Result<String> login() {
        // ...
    }
    
    // æ–¹æ³•çº§åˆ«å¯ä»¥è¦†ç›–ç±»çº§åˆ«é…ç½®
    @RateLimit(type = RateLimitType.IP, window = 60, maxRequests = 5)
    @PostMapping("/register")
    public Result<String> register() {
        // ...
    }
}
```

### 3. ç™»å½•æ¥å£ç‰¹æ®Šé™æµ

```java
@RestController
@RequestMapping("/api/auth")
public class AuthController {
    
    // ç™»å½•æ¥å£ï¼šIPé™æµï¼Œ30ç§’å†…æœ€å¤š5æ¬¡
    @RateLimit(
        type = RateLimitType.IP,
        window = 30,
        maxRequests = 5,
        message = "ç™»å½•å°è¯•è¿‡äºé¢‘ç¹ï¼Œè¯·30ç§’åå†è¯•"
    )
    @PostMapping("/login")
    public Result<String> login(@RequestBody LoginRequest request) {
        // ...
    }
}
```

### 4. Tokené™æµï¼ˆæ£€æµ‹æ³„éœ²ï¼‰

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // Tokené™æµï¼šæ£€æµ‹Tokenä½¿ç”¨é¢‘ç‡
    @RateLimit(
        type = RateLimitType.TOKEN,
        window = 60,
        maxRequests = 100,
        algorithm = RateLimitAlgorithm.SLIDING_WINDOW
    )
    @GetMapping("/sensitive-data")
    public Result<SensitiveData> getSensitiveData() {
        // ...
    }
}
```

### 5. å…¨å±€é™æµ

```java
@RestController
@RequestMapping("/api/public")
public class PublicController {
    
    // å…¨å±€é™æµï¼šæ‰€æœ‰è¯·æ±‚å…±äº«é™æµ
    @RateLimit(
        type = RateLimitType.GLOBAL,
        window = 60,
        maxRequests = 1000
    )
    @GetMapping("/data")
    public Result<Data> getData() {
        // ...
    }
}
```

## âš™ï¸ é…ç½®è¯´æ˜

### application.yml é…ç½®

```yaml
kite:
  auth:
    rate-limit:
      enabled: true                    # æ˜¯å¦å¯ç”¨é™æµï¼ˆé»˜è®¤ï¼štrueï¼‰
      default-window: 60               # é»˜è®¤æ—¶é—´çª—å£ï¼ˆç§’ï¼Œé»˜è®¤ï¼š60ï¼‰
      default-max-requests: 100        # é»˜è®¤æœ€å¤§è¯·æ±‚æ•°ï¼ˆé»˜è®¤ï¼š100ï¼‰
      default-algorithm: SLIDING_WINDOW # é»˜è®¤ç®—æ³•ï¼ˆé»˜è®¤ï¼šSLIDING_WINDOWï¼‰
      
      # IPé™æµé…ç½®
      ip:
        enabled: true                  # æ˜¯å¦å¯ç”¨IPé™æµï¼ˆé»˜è®¤ï¼štrueï¼‰
        window: 60                     # æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
        max-requests: 100              # æœ€å¤§è¯·æ±‚æ•°
      
      # ç”¨æˆ·é™æµé…ç½®
      user:
        enabled: true                   # æ˜¯å¦å¯ç”¨ç”¨æˆ·é™æµï¼ˆé»˜è®¤ï¼štrueï¼‰
        window: 60                     # æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
        max-requests: 200              # æœ€å¤§è¯·æ±‚æ•°
      
      # Tokené™æµé…ç½®
      token:
        enabled: true                   # æ˜¯å¦å¯ç”¨Tokené™æµï¼ˆé»˜è®¤ï¼štrueï¼‰
        window: 60                     # æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
        max-requests: 500              # æœ€å¤§è¯·æ±‚æ•°
      
      # å…¨å±€é™æµé…ç½®
      global:
        enabled: false                  # æ˜¯å¦å¯ç”¨å…¨å±€é™æµï¼ˆé»˜è®¤ï¼šfalseï¼‰
        window: 60                     # æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
        max-requests: 1000             # æœ€å¤§è¯·æ±‚æ•°
```

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `enabled` | æ˜¯å¦å¯ç”¨é™æµ | `true` |
| `default-window` | é»˜è®¤æ—¶é—´çª—å£ï¼ˆç§’ï¼‰ | `60` |
| `default-max-requests` | é»˜è®¤æœ€å¤§è¯·æ±‚æ•° | `100` |
| `default-algorithm` | é»˜è®¤ç®—æ³• | `SLIDING_WINDOW` |
| `ip.enabled` | IPé™æµå¼€å…³ | `true` |
| `user.enabled` | ç”¨æˆ·é™æµå¼€å…³ | `true` |
| `token.enabled` | Tokené™æµå¼€å…³ | `true` |
| `global.enabled` | å…¨å±€é™æµå¼€å…³ | `false` |

## ğŸ“Š å“åº”æ ¼å¼

### æ­£å¸¸å“åº”

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {...}
}
```

### é™æµè§¦å‘å“åº”ï¼ˆ429ï¼‰

```json
{
  "code": 429,
  "message": "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ï¼ˆå‰©ä½™è¯·æ±‚æ•°: 0ï¼Œé‡ç½®æ—¶é—´: 45ç§’åï¼‰",
  "timestamp": 1638359940000
}
```

## ğŸ” é™æµæ£€æŸ¥ä½ç½®

é™æµæ£€æŸ¥åœ¨è®¤è¯æµç¨‹çš„**æœ€å‰é¢**æ‰§è¡Œï¼š

```
1. ã€é™æµæ£€æŸ¥ã€‘â† åœ¨è¿™é‡Œæ£€æŸ¥ï¼ˆ@RateLimit æ³¨è§£ï¼‰
2. è®¤è¯è¿‡æ»¤å™¨ï¼ˆAuthenticationFilterï¼‰
3. æƒé™æ£€æŸ¥ï¼ˆ@RequiresPermissions/@RequiresRolesï¼‰
4. ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
```

è¿™æ ·å¯ä»¥ï¼š
- âœ… é¿å…æ— æ•ˆè¯·æ±‚æ¶ˆè€—èµ„æº
- âœ… ä¿æŠ¤ç³»ç»Ÿå…å—æ¶æ„è¯·æ±‚
- âœ… æé«˜ç³»ç»Ÿç¨³å®šæ€§

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šç™»å½•æ¥å£é™æµ

**é—®é¢˜**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£å¯†ç 

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
@RateLimit(
    type = RateLimitType.IP,
    window = 60,
    maxRequests = 5,
    message = "ç™»å½•å°è¯•è¿‡äºé¢‘ç¹ï¼Œè¯·60ç§’åå†è¯•"
)
@PostMapping("/login")
public Result<String> login(@RequestBody LoginRequest request) {
    // ...
}
```

### åœºæ™¯2ï¼šæ•æ„Ÿæ“ä½œé™æµ

**é—®é¢˜**ï¼šé˜²æ­¢ç”¨æˆ·é¢‘ç¹æ‰§è¡Œæ•æ„Ÿæ“ä½œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
@RateLimit(
    type = RateLimitType.USER,
    window = 300,  // 5åˆ†é’Ÿ
    maxRequests = 3,
    message = "æ“ä½œè¿‡äºé¢‘ç¹ï¼Œè¯·5åˆ†é’Ÿåå†è¯•"
)
@PostMapping("/transfer")
public Result<Void> transfer(@RequestBody TransferRequest request) {
    // ...
}
```

### åœºæ™¯3ï¼šTokenæ³„éœ²æ£€æµ‹

**é—®é¢˜**ï¼šæ£€æµ‹Tokenæ˜¯å¦è¢«æ³„éœ²ï¼ˆä½¿ç”¨é¢‘ç‡å¼‚å¸¸ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
@RateLimit(
    type = RateLimitType.TOKEN,
    window = 60,
    maxRequests = 100,
    algorithm = RateLimitAlgorithm.SLIDING_WINDOW
)
@GetMapping("/api/data")
public Result<Data> getData() {
    // å¦‚æœTokenä½¿ç”¨é¢‘ç‡è¶…è¿‡é™åˆ¶ï¼Œå¯èƒ½æ˜¯æ³„éœ²
    // å¯ä»¥åœ¨åˆ‡é¢ä¸­è®°å½•å¼‚å¸¸å¹¶åŠ å…¥é»‘åå•
}
```

### åœºæ™¯4ï¼šAPIå…¨å±€é™æµ

**é—®é¢˜**ï¼šä¿æŠ¤æ•´ä¸ªAPIæœåŠ¡

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
@RateLimit(
    type = RateLimitType.GLOBAL,
    window = 60,
    maxRequests = 1000
)
@RestController
@RequestMapping("/api/public")
public class PublicApiController {
    // æ‰€æœ‰æ¥å£å…±äº«é™æµ
}
```

## ğŸ› ï¸ ä»£ç ä¸­ä½¿ç”¨

### æ‰‹åŠ¨æ£€æŸ¥é™æµ

```java
@Autowired
private RateLimitService rateLimitService;

public void someMethod() {
    String key = "custom_key";
    boolean allowed = rateLimitService.allowRequest(key, 60, 100, RateLimitAlgorithm.SLIDING_WINDOW);
    
    if (!allowed) {
        long remaining = rateLimitService.getRemainingRequests(key, 60, 100);
        long resetTime = rateLimitService.getResetTime(key, 60);
        throw new BusinessException("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œå‰©ä½™: " + remaining + "ï¼Œé‡ç½®æ—¶é—´: " + resetTime + "ç§’");
    }
}
```

### è·å–é™æµä¿¡æ¯

```java
@Autowired
private RateLimitService rateLimitService;

// è·å–å‰©ä½™è¯·æ±‚æ•°
long remaining = rateLimitService.getRemainingRequests(key, 60, 100);

// è·å–é‡ç½®æ—¶é—´ï¼ˆç§’ï¼‰
long resetTime = rateLimitService.getResetTime(key, 60);
```

### æ¸…é™¤é™æµè®°å½•

```java
@Autowired
private RateLimitService rateLimitService;

// æ¸…é™¤æŒ‡å®škeyçš„é™æµè®°å½•ï¼ˆç”¨äºæµ‹è¯•æˆ–æ‰‹åŠ¨é‡ç½®ï¼‰
rateLimitService.clearRateLimit(key);
```

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

### Redis æ“ä½œæ€§èƒ½

- **æ»‘åŠ¨çª—å£**ï¼šæ¯æ¬¡è¯·æ±‚éœ€è¦ 2-3 æ¬¡ Redis æ“ä½œï¼ˆåˆ é™¤è¿‡æœŸè®°å½•ã€ç»Ÿè®¡ã€æ·»åŠ ï¼‰
- **å›ºå®šçª—å£**ï¼šæ¯æ¬¡è¯·æ±‚éœ€è¦ 1-2 æ¬¡ Redis æ“ä½œï¼ˆé€’å¢ã€è®¾ç½®TTLï¼‰

### ä¼˜åŒ–å»ºè®®

1. **åˆç†è®¾ç½®æ—¶é—´çª—å£**ï¼šä¸è¦è®¾ç½®è¿‡çŸ­ï¼ˆä¼šå¢åŠ Redisæ“ä½œï¼‰
2. **åˆç†è®¾ç½®æœ€å¤§è¯·æ±‚æ•°**ï¼šæ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚è®¾ç½®
3. **ç›‘æ§Redisæ€§èƒ½**ï¼šå®šæœŸæ£€æŸ¥é™æµç›¸å…³çš„Redis keyæ•°é‡
4. **ä½¿ç”¨å›ºå®šçª—å£**ï¼šå¦‚æœå¯¹ç²¾åº¦è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥ä½¿ç”¨å›ºå®šçª—å£ç®—æ³•ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰

## ğŸ” å®‰å…¨å»ºè®®

1. **ç™»å½•æ¥å£å¿…é¡»é™æµ**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£
2. **æ•æ„Ÿæ“ä½œé™æµ**ï¼šé˜²æ­¢æ¶æ„æ“ä½œ
3. **Tokené™æµç›‘æ§**ï¼šæ£€æµ‹Tokenæ³„éœ²
4. **åˆç†è®¾ç½®é™æµå‚æ•°**ï¼šä¸è¦è®¾ç½®è¿‡ä¸¥æˆ–è¿‡æ¾
5. **ç›‘æ§é™æµè§¦å‘**ï¼šè®°å½•é™æµæ—¥å¿—ï¼Œåˆ†æå¼‚å¸¸è¡Œä¸º

## ğŸ“š æ³¨è§£å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `type` | RateLimitType | é™æµç»´åº¦ï¼ˆIP/USER/TOKEN/GLOBALï¼‰ | `IP` |
| `window` | int | æ—¶é—´çª—å£ï¼ˆç§’ï¼‰ | `60` |
| `maxRequests` | int | æœ€å¤§è¯·æ±‚æ•° | `100` |
| `algorithm` | RateLimitAlgorithm | é™æµç®—æ³• | `SLIDING_WINDOW` |
| `message` | String | é™æµæç¤ºä¿¡æ¯ | `"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"` |
| `enabled` | boolean | æ˜¯å¦å¯ç”¨ | `true` |

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šé™æµä¸ç”Ÿæ•ˆ

**å¯èƒ½åŸå› **ï¼š
- Redis æœªé…ç½®æˆ–è¿æ¥å¤±è´¥
- RateLimitService æœªæ­£ç¡®æ³¨å…¥
- é™æµåŠŸèƒ½è¢«ç¦ç”¨ï¼ˆ`kite.auth.rate-limit.enabled=false`ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// æ£€æŸ¥ Redis è¿æ¥
@Autowired
private RedisTemplate<String, Object> redisTemplate;

// æ£€æŸ¥ RateLimitService
@Autowired(required = false)
private RateLimitService rateLimitService;

// æ£€æŸ¥é…ç½®
@Value("${kite.auth.rate-limit.enabled:true}")
private Boolean rateLimitEnabled;
```

### é—®é¢˜2ï¼šé™æµè¿‡ä¸¥

**å¯èƒ½åŸå› **ï¼š
- æ—¶é—´çª—å£è®¾ç½®è¿‡çŸ­
- æœ€å¤§è¯·æ±‚æ•°è®¾ç½®è¿‡å°
- é™æµKeyæå–é”™è¯¯ï¼ˆå¯¼è‡´ä¸åŒè¯·æ±‚ä½¿ç”¨ç›¸åŒkeyï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è°ƒæ•´ `window` å’Œ `maxRequests` å‚æ•°
- æ£€æŸ¥é™æµKeyçš„ç”Ÿæˆé€»è¾‘
- ä½¿ç”¨ `getRemainingRequests()` è°ƒè¯•

### é—®é¢˜3ï¼šRediså†…å­˜å ç”¨è¿‡é«˜

**å¯èƒ½åŸå› **ï¼š
- é™æµKeyè¿‡å¤š
- æ—¶é—´çª—å£è®¾ç½®è¿‡é•¿
- å›ºå®šçª—å£çš„keyæœªåŠæ—¶æ¸…ç†

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¼©çŸ­æ—¶é—´çª—å£
- å®šæœŸæ¸…ç†è¿‡æœŸçš„é™æµè®°å½•
- ç›‘æ§Rediså†…å­˜ä½¿ç”¨æƒ…å†µ

## ğŸ“ æœ€ä½³å®è·µ

1. **ç™»å½•æ¥å£å¿…é¡»é™æµ**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£
   ```java
   @RateLimit(type = RateLimitType.IP, window = 60, maxRequests = 5)
   ```

2. **æ•æ„Ÿæ“ä½œé™æµ**ï¼šé˜²æ­¢æ¶æ„æ“ä½œ
   ```java
   @RateLimit(type = RateLimitType.USER, window = 300, maxRequests = 3)
   ```

3. **ä½¿ç”¨æ»‘åŠ¨çª—å£**ï¼šæ›´ç²¾ç¡®çš„é™æµï¼ˆæ¨èï¼‰
   ```java
   @RateLimit(algorithm = RateLimitAlgorithm.SLIDING_WINDOW)
   ```

4. **åˆç†è®¾ç½®å‚æ•°**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´
   - ç™»å½•æ¥å£ï¼šä¸¥æ ¼ï¼ˆ5æ¬¡/åˆ†é’Ÿï¼‰
   - æ™®é€šæ¥å£ï¼šä¸­ç­‰ï¼ˆ100æ¬¡/åˆ†é’Ÿï¼‰
   - æŸ¥è¯¢æ¥å£ï¼šå®½æ¾ï¼ˆ500æ¬¡/åˆ†é’Ÿï¼‰

5. **ç›‘æ§å’Œå‘Šè­¦**ï¼šè®°å½•é™æµæ—¥å¿—ï¼Œå¼‚å¸¸æ—¶å‘Šè­¦

## ğŸ“š ç›¸å…³æ¥å£

### æ³¨è§£

- `@RateLimit` - é™æµæ³¨è§£

### æœåŠ¡

- `RateLimitService` - é™æµæœåŠ¡

### æšä¸¾

- `RateLimitType` - é™æµç±»å‹
- `RateLimitAlgorithm` - é™æµç®—æ³•

## ğŸ”„ ä¸Tokené»‘åå•çš„é…åˆ

é™æµå’ŒTokené»‘åå•å¯ä»¥é…åˆä½¿ç”¨ï¼š

```java
// 1. é™æµæ£€æµ‹å¼‚å¸¸è¡Œä¸º
if (rateLimitService.exceedLimit(token, 60, 100)) {
    // 2. Tokenä½¿ç”¨å¼‚å¸¸ï¼ŒåŠ å…¥é»‘åå•
    tokenBlacklistService.blacklistToken(token, "ä½¿ç”¨é¢‘ç‡å¼‚å¸¸");
    // 3. è®°å½•å®‰å…¨äº‹ä»¶
    logSecurityEvent("Tokenä½¿ç”¨å¼‚å¸¸", token);
}
```

## ğŸ“ æ€»ç»“

é™æµåŠŸèƒ½æä¾›äº†å¼ºå¤§çš„è¯·æ±‚æ§åˆ¶èƒ½åŠ›ï¼š

1. âœ… **å¤šç»´åº¦é™æµ**ï¼šIPã€ç”¨æˆ·ã€Tokenã€å…¨å±€
2. âœ… **åŒç®—æ³•æ”¯æŒ**ï¼šæ»‘åŠ¨çª—å£å’Œå›ºå®šçª—å£
3. âœ… **æ³¨è§£é©±åŠ¨**ï¼šç®€å•æ˜“ç”¨
4. âœ… **åˆ†å¸ƒå¼æ”¯æŒ**ï¼šåŸºäºRedisï¼Œæ”¯æŒå¤šèŠ‚ç‚¹
5. âœ… **çµæ´»é…ç½®**ï¼šæ”¯æŒå¤šç§é…ç½®æ–¹å¼

é€šè¿‡åˆç†ä½¿ç”¨é™æµåŠŸèƒ½ï¼Œå¯ä»¥æœ‰æ•ˆä¿æŠ¤ç³»ç»Ÿå…å—æ¶æ„è¯·æ±‚ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚

